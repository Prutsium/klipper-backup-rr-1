[gcode_macro START_PRINT]
gcode:
  SAVE_GCODE_STATE NAME=start_print_state
  G21 ;metric values
  G90 ;absolute positioning
  M82 ;set extruder to absolute mode
  G28 ;home
  M117 Heating Bed...
  RUN_SHELL_COMMAND CMD=heating_led
  M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) } ; wait for bed to heat up
  M109 S150 ; Wait for extruder to reach 150 so an inductive probe (if present) is at a predictable temp. Also allows the bed heat to spread a little.
  RUN_SHELL_COMMAND CMD=ztilt_led
  Z_TILT_ADJUST ;Adjust bed tilt
  G28 Z ;Home again as Z will have changed after tilt adjustment and bed heating.
  RUN_SHELL_COMMAND CMD=mesh_led
  BED_MESH_CALIBRATE PROFILE=vcoreos ; Calibrate bed mesh
  BED_MESH_PROFILE LOAD=vcoreos
  G0 X{printer.toolhead.axis_maximum.x / 2} Y0 Z50 F15000 ; Park in the front and wait for extruder
  M117 Heating Nozzle...
  RUN_SHELL_COMMAND CMD=heating_led
  M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) } ; wait for extruder to heat up
  M117 Purging...
  G92 E0 ;zero the extruded length
  G1 E-3 ; retract a bit
  M106 S128 ; 50% part fan
  G1 X5 Y10 Z1 F16000 ; move to blob position
  G1 F200 E25 ; extrude a blob 
  G1 Z5 F200 E30 ; move the extruder up by 10mm while extruding, breaks away from blob
  G1 F200 Y25 E31.5 ; move to wipe, but keep extruding so it is attached to blob
  G1 F200 Y35 Z0.2 E32.5 ; down diagonally while extruding
  G1 F200 Y45 Z0.2 E33.5 ; small line
  G1 F16000 Y100 E32 ;wipe
  NOZZLE_WIPE
  M117 Printing...
  RUN_SHELL_COMMAND CMD=printing_led
  RESTORE_GCODE_STATE NAME=start_print_state
  M82
  G92 E-1.5 ; reset extruder at retracted position

#[gcode_macro START_PRINT]
#gcode:
#  SAVE_GCODE_STATE NAME=start_print_state
#  G21 ;metric values
#  G90 ;absolute positioning
#  M82 ;set extruder to absolute mode
#  G28 ;home
#  M117 Heating Bed...
#  RUN_SHELL_COMMAND CMD=heating_led
#  M190 S{params.BED_TEMP|default(printer.heater_bed.target, true) }; wait for bed to heat up
#  M109 S150 ; Wait for extruder to reach 150 so an inductive probe (if present) is at a predictable temp. Also allows the bed heat to spread a little.
#  RUN_SHELL_COMMAND CMD=ztilt_led
#  Z_TILT_ADJUST ;Adjust bed tilt
#  G28 Z ;Home again as Z will have changed after tilt adjustment and bed heating.
#  RUN_SHELL_COMMAND CMD=mesh_led
#  BED_MESH_CALIBRATE PROFILE=vcoreos ; Calibrate bed mesh
#  BED_MESH_PROFILE LOAD=vcoreos
#  G0 X{printer.toolhead.axis_maximum.x / 2} Y{printer.toolhead.axis_maximum.y} Z50 F6000 ; Park in the back and wait for extruder
#  M117 Heating Nozzle...
#  RUN_SHELL_COMMAND CMD=heating_led
#  M109 S{params.EXTRUDER_TEMP|default(printer.extruder.target, true) }; wait for extruder to heat up
#  RUN_SHELL_COMMAND CMD=printing_led
#  M117 Printing...
#  RESTORE_GCODE_STATE NAME=start_print_state
#  M82
#  G92 E0

[gcode_shell_command heating_led]
command: curl "http://192.168.99.50/win&PL=3"
timeout: 2.
verbose: false

[gcode_shell_command mesh_led]
command: curl "http://192.168.99.50/win&PL=6"
timeout: 2.
verbose: false

[gcode_shell_command ztilt_led]
command: curl "http://192.168.99.50/win&PL=5"
timeout: 2.
verbose: false

[gcode_shell_command printing_led]
command: curl "http://192.168.99.50/win&PL=2"
timeout: 2.
verbose: false

